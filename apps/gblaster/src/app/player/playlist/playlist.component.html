<mat-action-list cdkDropList [cdkDropListDisabled]="isLoading | async" (cdkDropListDropped)="drop($event)" dense class="pl" *mobxAutorun>
  <mat-list-item
    cdkDrag
    *ngFor="let song of songs; let index = index; trackBy: playlistTrackFunction"
    [ngClass]="{ selected: isSelected(song) }"
    class="playlist-item"
    (dblclick)="playPauseSong($event, song)"
    (click)="selectSong(song)"
  >
    <span *cdkDragPreview></span>
    <div cdkDragHandle mat-list-avatar style="overflow: hidden; border-radius: 3px; position: relative">
      <img
        *ngIf="song && song.metadata && song.metadata.coverUrl"
        style="position: absolute; top: 0; right: 0; bottom: 0; left: 0; width: 100%; height: 100%"
        [src]="song.metadata.coverUrl.thumb | safe : 'resourceUrl'"
        loading="lazy"
      />
      <canvas
        *ngIf="isPlayingSong(song) && isPlaying(song) && visualMode !== 'off'"
        [mode]="visualMode"
        style="position: absolute; right: 0; bottom: 0; left: 0; width: 100%; height: 300%"
        [style.height.%]="visualMode === 'bars' ? 250 : 100"
        [colorConfig]="colorConfig"
        [mtbVisual]="analyser"
        [oscConfig]="{ thickness: 1 }"
        [barsConfig]="{ capHeight: 0, barCount: 8, gap: 0, capFalldown: 0 }"
      ></canvas>
    </div>

    <h3 matLine style="font-size: 0.9rem; font-weight: bold">{{ song?.metadata?.title || song.file.name }}</h3>
    <p matLine style="font-size: 0.8rem">{{ song?.metadata?.artist }}</p>

    <button *ngIf="isPlayingSong(song)" mat-icon-button (click)="playPauseSong($event, song)">
      <mat-icon *ngIf="!isPlaying(song)" class="accent-color" svgIcon="play-outline"></mat-icon>
      <mat-icon *ngIf="isPlaying(song)" class="accent-color" svgIcon="pause"></mat-icon>
    </button>
  </mat-list-item>
  <ng-content></ng-content>
</mat-action-list>
